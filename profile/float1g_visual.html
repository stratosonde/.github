<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Step-by-Step Balloon Calculator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{font-family:'Segoe UI',Arial,sans-serif;margin:20px;background:#f0f2f5;max-width:1200px;margin:20px auto;}
h1{color:#1a1a1a;text-align:center;margin-bottom:10px;}
.subtitle{text-align:center;color:#666;margin-bottom:30px;font-size:1.1em;}
.step{background:#fff;border-radius:12px;margin-bottom:25px;padding:25px;box-shadow:0 2px 8px rgba(0,0,0,0.1);border-left:6px solid #ccc;}
.step-1{border-left-color:#4CAF50;}.step-2{border-left-color:#2196F3;}.step-3{border-left-color:#FF9800;}
.step-4{border-left-color:#9C27B0;}.step-5{border-left-color:#F44336;}
.step-header{display:flex;align-items:center;margin-bottom:15px;gap:12px;}
.step-number{background:#1a1a1a;color:white;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:20px;flex-shrink:0;}
.step-title{font-size:1.5em;font-weight:600;color:#1a1a1a;margin:0;}
.step-description{color:#555;margin-bottom:20px;line-height:1.6;font-size:1.05em;}
.inputs-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:18px;margin-top:15px;}
.input-group{margin-bottom:0;}
.input-group label{display:block;font-weight:600;margin-bottom:6px;color:#333;font-size:0.95em;}
.input-help{font-size:0.85em;color:#666;margin-top:3px;}
.input-group input,.input-group select{width:100%;padding:12px;border:2px solid #ddd;border-radius:8px;font-size:1em;box-sizing:border-box;transition:border-color 0.2s;}
.input-group input:focus,.input-group select:focus{outline:none;border-color:#2196F3;}
.calculation-box{background:#f8f9fa;padding:20px;border-radius:8px;margin:15px 0;border:2px solid #dee2e6;}
.calc-step{margin:12px 0;padding:10px;background:white;border-radius:6px;}
.calc-label{color:#666;font-size:0.9em;margin-bottom:5px;}
.calc-equation{color:#1976D2;font-weight:600;margin:5px 0;font-family:monospace;}
.calc-values{color:#2e7d32;margin:5px 0;font-family:monospace;}
.result-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:15px;margin-top:20px;}
.result-item{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:18px;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
.result-label{font-size:0.9em;opacity:0.9;margin-bottom:8px;}
.result-value{font-size:1.8em;font-weight:bold;}
.result-unit{font-size:0.7em;opacity:0.9;margin-left:4px;}
.explanation{background:#fff8e1;border-left:4px solid #ffc107;border-radius:6px;padding:15px;margin:15px 0;line-height:1.7;}
.explanation strong{color:#f57c00;}
.safety-indicator{padding:20px;border-radius:10px;margin:20px 0;font-weight:bold;text-align:center;font-size:1.1em;}
.safety-safe{background:linear-gradient(135deg,#81c784 0%,#66bb6a 100%);color:white;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
.safety-caution{background:linear-gradient(135deg,#ffb74d 0%,#ffa726 100%);color:white;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
.safety-danger{background:linear-gradient(135deg,#e57373 0%,#ef5350 100%);color:white;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
.chart-container{background:#fff;padding:25px;border-radius:12px;margin:25px 0;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
.chart-title{font-size:1.3em;font-weight:600;margin-bottom:15px;color:#1a1a1a;}
button{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;padding:12px 24px;border-radius:8px;cursor:pointer;font-size:1em;font-weight:600;box-shadow:0 4px 6px rgba(0,0,0,0.1);transition:transform 0.2s;}
button:hover{transform:translateY(-2px);box-shadow:0 6px 12px rgba(0,0,0,0.15);}
.info-box{background:#e3f2fd;border-left:4px solid #2196F3;padding:15px;border-radius:6px;margin:15px 0;}
.info-box strong{color:#1565c0;}
</style>
</head>
<body>
<h1>ğŸˆ Superpressure Balloon Calculator</h1>
<p class="subtitle">Follow the physics step-by-step | Based on <a href="https://ukhas.org.uk/doku.php?id=projects:splat" target="_blank">UKHAS SPLAT</a></p>

<div class="intro-box" style="background:#e3f2fd;border-left:4px solid #2196F3;padding:20px;border-radius:8px;margin:20px 0;line-height:1.7;">
<h3 style="margin-top:0;color:#1565c0;">ğŸ“š About This Calculator</h3>
<p><strong>What this calculator does:</strong> Computes the equilibrium state of a superpressure balloon - where it will float and the stress on the envelope. This is a <em>static equilibrium calculator</em> that solves for the final steady-state conditions.</p>
<p><strong>New feature:</strong> Optional pressure relief valve simulation shows how venting gas affects float altitude and safety margins.</p>
<p><strong>For full trajectory prediction:</strong> Use <a href="https://predictor.stratosonde.org" target="_blank">predictor.stratosonde.org</a> for multi-day flight paths with real weather data.</p>
</div>

<!-- RESULTS SUMMARY -->
<div id="resultsSummary" style="background:#fff;border-radius:12px;padding:25px;margin-bottom:25px;box-shadow:0 4px 12px rgba(0,0,0,0.15);border-left:6px solid #667eea;">
<h2 style="margin:0 0 20px 0;color:#1a1a1a;font-size:1.4em;display:flex;align-items:center;gap:10px;">
<span>ğŸ“Š Results Summary</span>
<span style="font-size:0.6em;color:#666;font-weight:normal;">(Updates automatically)</span>
</h2>
<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:15px;">
<div style="background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;padding:15px;border-radius:10px;">
<div style="font-size:0.85em;opacity:0.9;margin-bottom:5px;">ğŸ¯ Float Altitude</div>
<div style="font-size:1.6em;font-weight:bold;"><span id="summary_float_m">--</span> m</div>
<div style="font-size:0.9em;opacity:0.8;"><span id="summary_float_ft">--</span> ft</div>
</div>
<div style="background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:white;padding:15px;border-radius:10px;">
<div style="font-size:0.85em;opacity:0.9;margin-bottom:5px;">ğŸ“ Onset Altitude</div>
<div style="font-size:1.6em;font-weight:bold;"><span id="summary_onset_m">--</span> m</div>
<div style="font-size:0.9em;opacity:0.8;"><span id="summary_onset_ft">--</span> ft</div>
</div>
<div style="background:linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);color:white;padding:15px;border-radius:10px;">
<div style="font-size:0.85em;opacity:0.9;margin-bottom:5px;">â¬†ï¸ Initial Ascent</div>
<div style="font-size:1.6em;font-weight:bold;"><span id="summary_ascent_ms">--</span> m/s</div>
<div style="font-size:0.9em;opacity:0.8;"><span id="summary_ascent_fpm">--</span> ft/min</div>
</div>
<div style="background:linear-gradient(135deg,#fa709a 0%,#fee140 100%);color:white;padding:15px;border-radius:10px;">
<div style="font-size:0.85em;opacity:0.9;margin-bottom:5px;">ğŸ’¨ Fill Volume</div>
<div style="font-size:1.6em;font-weight:bold;"><span id="summary_fill">--</span> L</div>
<div style="font-size:0.9em;opacity:0.8;">@ <span id="summary_fill_ratio">--</span>% full</div>
</div>
<div id="summary_safety_card" style="background:linear-gradient(135deg,#81c784 0%,#66bb6a 100%);color:white;padding:15px;border-radius:10px;">
<div style="font-size:0.85em;opacity:0.9;margin-bottom:5px;">âš ï¸ Pressure Safety</div>
<div style="font-size:1.6em;font-weight:bold;"><span id="summary_diff_psi">--</span> psi</div>
<div style="font-size:0.9em;opacity:0.8;font-weight:600;"><span id="summary_safety_status">--</span></div>
</div>
<div id="summary_valve_card" style="display:none;background:linear-gradient(135deg,#30cfd0 0%,#330867 100%);color:white;padding:15px;border-radius:10px;">
<div style="font-size:0.85em;opacity:0.9;margin-bottom:5px;">ğŸ”“ Valve Status</div>
<div style="font-size:1.6em;font-weight:bold;">ACTIVE</div>
<div style="font-size:0.9em;opacity:0.8;"><span id="summary_valve_info">--</span></div>
</div>
</div>
</div>

<div class="step step-1">
<div class="step-header"><div class="step-number">1</div><h2 class="step-title">Define Your Balloon System</h2></div>
<p class="step-description">Enter balloon, payload, and launch conditions.</p>
<div class="explanation"><strong>ğŸ’¡ Intuition:</strong> Think of this like packing for a trip - you need to know what you're carrying. Every gram matters because it affects how high the balloon can float!</div>
<div class="inputs-grid">
<div class="input-group"><label for="gas_type">ğŸŒ¬ï¸ Lifting Gas</label>
<select id="gas_type">
<option value="0.08522">Hydrogen (0.08522 kg/mÂ³ at 15Â°C)</option>
<option value="0.0922">Hydrogen 97% (0.0922 kg/mÂ³)</option>
<option value="0.1693">Helium (0.1693 kg/mÂ³ at 15Â°C)</option>
<option value="0.2010">Helium 97% (0.2010 kg/mÂ³ at 15Â°C)</option>
</select><div class="input-help">Gas used to fill balloon</div></div>
<div class="input-group"><label for="balloon_volume">ğŸ“ Balloon Max Volume</label>
<input type="number" id="balloon_volume" value="0.5" step="0.01">
<div class="input-help">mÂ³ - When fully inflated</div></div>
<div class="input-group"><label for="balloon_weight">âš–ï¸ Balloon Weight</label>
<input type="number" id="balloon_weight" value="105" step="1">
<div class="input-help">grams - Envelope only</div></div>
<div class="input-group"><label for="payload_weight">ğŸ“¦ Payload Weight</label>
<input type="number" id="payload_weight" value="10" step="1">
<div class="input-help">grams - All non-balloon</div></div>
<div class="input-group"><label for="free_lift">â¬†ï¸ Free Lift</label>
<input type="number" id="free_lift" value="8" step="1">
<div class="input-help">grams - Extra lift</div></div>
<div class="input-group"><label for="launch_elevation">ğŸ”ï¸ Launch Elevation</label>
<input type="number" id="launch_elevation" value="0" step="10">
<div class="input-help">meters - Above sea level</div></div>
<div class="input-group"><label for="launch_temp">ğŸŒ¡ï¸ Launch Temperature</label>
<input type="number" id="launch_temp" value="15" step="0.1">
<div class="input-help">Â°C - At ground</div></div>
</div>
<div class="info-box" style="margin-top:20px;"><strong>âš™ï¸ Pressure Relief Valve</strong> (Optional Safety Feature)</div>
<div class="inputs-grid">
<div class="input-group"><label><input type="checkbox" id="valve_enabled" style="width:auto;margin-right:8px;">Enable Pressure Relief Valve</label>
<div class="input-help">Limits max pressure differential</div></div>
<div class="input-group"><label for="valve_pressure_limit">ğŸ”“ Pressure Limit</label>
<input type="number" id="valve_pressure_limit" value="0.6" step="0.05" min="0.1" max="2.0">
<div class="input-help">psi - Max differential pressure</div></div>
</div>
<div class="explanation" style="background:#f3e5f5;border-left-color:#9c27b0;"><strong>ğŸ“ Physics:</strong> The system's total mass (envelope + payload + gas) determines how much air must be displaced to achieve neutral buoyancy. More mass = deeper into atmosphere = higher float altitude.</div>
</div>

<div class="step step-2">
<div class="step-header"><div class="step-number">2</div><h2 class="step-title">Launch Conditions & Fill Volume</h2></div>
<p class="step-description">Calculate atmospheric conditions at launch and required gas fill.</p>
<div class="explanation"><strong>ğŸ’¡ Intuition:</strong> Like inflating a balloon until a scale shows the right weight. The "neck lift" is what you'd measure with a spring scale at the balloon's neck before release.</div>
<div class="calculation-box">
<div class="calc-step"><div class="calc-label">Gas mass</div>
<div class="calc-equation">Gas Mass = Volume Ã— Density Ã— 1000</div>
<div class="calc-values" id="calc_gas_mass"></div></div>
<div class="calc-step"><div class="calc-label">Total mass</div>
<div class="calc-equation">Total = Balloon + Payload + Gas</div>
<div class="calc-values" id="calc_total_mass"></div></div>
<div class="calc-step"><div class="calc-label">System density</div>
<div class="calc-equation">Density = Mass / Volume</div>
<div class="calc-values" id="calc_system_density"></div></div>
</div>
<div class="result-grid">
<div class="result-item"><div class="result-label">Gas Mass</div>
<div class="result-value"><span id="gas_mass">0</span><span class="result-unit">g</span></div></div>
<div class="result-item"><div class="result-label">Total Mass</div>
<div class="result-value"><span id="total_mass">0</span><span class="result-unit">g</span></div></div>
<div class="result-item"><div class="result-label">System Density</div>
<div class="result-value"><span id="system_density">0</span><span class="result-unit">kg/mÂ³</span></div></div>
<div class="explanation" style="background:#f3e5f5;border-left-color:#9c27b0;"><strong>ğŸ“ Physics:</strong> The ISA (International Standard Atmosphere) model calculates pressure and temperature at any altitude. We use actual launch temperature (not ISA) for accuracy. The fill volume creates enough buoyant force to lift the total system mass plus provide excess "free lift" for ascent.</div>
</div>

<div class="step step-3">
<div class="step-header"><div class="step-number">3</div><h2 class="step-title">Forces & Initial Ascent Rate</h2></div>
<p class="step-description">Analyze forces and calculate how fast the balloon rises at launch.</p>
<div class="explanation"><strong>ğŸ’¡ Intuition:</strong> Why does the balloon go up? Because the upward buoyant force (weight of displaced air) is greater than the downward weight force. The difference drives acceleration until air resistance (drag) balances it out.</div>
<div class="calculation-box">
<div class="calc-step"><div class="calc-label">Buoyancy force (upward)</div>
<div class="calc-equation">F_buoyancy = Ï_air Ã— V Ã— g</div>
<div class="calc-values" id="calc_buoyancy"></div></div>
<div class="calc-step"><div class="calc-label">Weight force (downward)</div>
<div class="calc-equation">F_weight = m_total Ã— g</div>
<div class="calc-values" id="calc_weight"></div></div>
<div class="calc-step"><div class="calc-label">Net upward force</div>
<div class="calc-equation">F_net = F_buoyancy - F_weight</div>
<div class="calc-values" id="calc_net_force"></div></div>
<div class="calc-step"><div class="calc-label">Terminal ascent velocity (with drag)</div>
<div class="calc-equation">v = âˆš(2Ã—F_net / (C_dÃ—Ï_airÃ—A))</div>
<div class="calc-values" id="calc_ascent_rate"></div></div>
</div>
<div class="explanation" style="background:#f3e5f5;border-left-color:#9c27b0;"><strong>ğŸ“ Physics:</strong> The balloon doesn't accelerate forever - drag force increases with velocity until it balances the net force. This is "terminal velocity."</div>
<div class="result-grid">
<div class="result-item"><div class="result-label">Initial Ascent Rate</div>
<div class="result-value"><span id="ascent_rate_ms">0</span><span class="result-unit">m/s</span></div></div>
<div class="result-item"><div class="result-label">Initial Ascent Rate</div>
<div class="result-value"><span id="ascent_rate_fpm">0</span><span class="result-unit">ft/min</span></div></div>
<div class="result-item"><div class="result-label">Net Force</div>
<div class="result-value"><span id="net_force">0</span><span class="result-unit">N</span></div></div>
</div></div>

<div class="step step-4">
<div class="step step-4">
<div class="step-header"><div class="step-number">4</div><h2 class="step-title">Superpressure Onset Altitude</h2></div>
<p class="step-description">Where the balloon reaches maximum volume and stops expanding.</p>
<div class="explanation"><strong>ğŸ’¡ Intuition:</strong> As the balloon ascends, decreasing atmospheric pressure allows the gas to expand (like a sealed bag of chips on an airplane). The balloon reaches max size when this expanded gas fills the entire envelope.</div>
<div class="calculation-box">
<div class="calc-step"><div class="calc-label">Finding altitude</div>
<div class="calc-equation">V_expand = V_fill Ã— (P_launch/P_h) Ã— (T_h/T_launch)</div>
<div class="calc-values" id="calc_float_search"></div></div>
</div>
<div class="explanation" style="background:#f3e5f5;border-left-color:#9c27b0;"><strong>ğŸ“ Physics:</strong> Below onset altitude, the balloon is in "free expansion" - it grows like a latex balloon as you blow it up. Above onset, it's in "superpressure" - the envelope is fully taut and internal pressure exceeds external pressure.</div>
<div class="result-grid">
<div class="result-item"><div class="result-label">Onset Altitude</div>
<div class="result-value"><span id="onset_altitude">0</span><span class="result-unit">m</span></div></div>
<div class="result-item"><div class="result-label">Onset Altitude</div>
<div class="result-value"><span id="onset_altitude_ft">0</span><span class="result-unit">ft</span></div></div>
</div></div>

<div class="step step-5">
<div class="step-header"><div class="step-number">5</div><h2 class="step-title">Float Altitude (Equilibrium)</h2></div>
<p class="step-description">Final altitude where buoyancy equals weight - neutral equilibrium.</p>
<div class="explanation"><strong>ğŸ’¡ Intuition:</strong> The balloon rises until it reaches an altitude where the air is so thin that the weight of displaced air exactly equals the weight of the balloon system. It's like a submarine adjusting ballast to hover at a specific depth.</div>
<div class="result-grid">
<div class="result-item"><div class="result-label">Float Altitude</div>
<div class="result-value"><span id="float_altitude">0</span><span class="result-unit">m</span></div></div>
<div class="result-item"><div class="result-label">Float Altitude</div>
<div class="result-value"><span id="float_altitude_ft">0</span><span class="result-unit">ft</span></div></div>
<div class="result-item"><div class="result-label">Altitude Gain</div>
<div class="result-value"><span id="altitude_gain">0</span><span class="result-unit">m</span></div></div>
<div class="result-item"><div class="result-label">Temp at Float</div>
<div class="result-value"><span id="temp_float">0</span><span class="result-unit">Â°C</span></div></div>
</div>
<div class="explanation" style="background:#f3e5f5;border-left-color:#9c27b0;"><strong>ğŸ“ Physics:</strong> At float altitude, net force = 0, so ascent rate = 0 (ignoring atmospheric vertical motions). The balloon has reached mechanical equilibrium. In reality, thermal effects cause Â±500-2000 m altitude oscillations around this mean value.</div>
</div>

<div class="step step-6" style="border-left-color:#00BCD4;">
<div class="step-header"><div class="step-number">6</div><h2 class="step-title">Pressure Analysis & Safety</h2></div>
<p class="step-description">Calculate envelope stress and check against burst limits.</p>
<div class="explanation"><strong>ğŸ’¡ Intuition:</strong> Don't confuse two different things! At float altitude: (1) NET FORCE goes to ZERO (buoyancy = weight), but (2) PRESSURE DIFFERENTIAL is at its MAXIMUM! The balloon is floating, but the envelope is under maximum stress.</div>
<div class="calculation-box">
<div class="calc-step"><div class="calc-label">Internal pressure</div>
<div class="calc-equation">P_int = (P_l Ã— V_f / T_l) Ã— (T_float / V_max)</div>
<div class="calc-values" id="calc_internal_pressure"></div></div>
<div class="calc-step"><div class="calc-label">Differential</div>
<div class="calc-equation">Î”P = P_internal - P_external</div>
<div class="calc-values" id="calc_diff_pressure"></div></div>
</div>
<div class="explanation"><strong>âš ï¸ Safety:</strong> Qualatex 36" burst at 4.7-5.4 kPa. Keep Î”P below this!</div>
<div class="result-grid">
<div class="result-item"><div class="result-label">Internal Pressure</div>
<div class="result-value"><span id="internal_pressure">0</span><span class="result-unit">kPa</span></div></div>
<div class="result-item"><div class="result-label">External Pressure</div>
<div class="result-value"><span id="pressure_float">0</span><span class="result-unit">kPa</span></div></div>
<div class="result-item"><div class="result-label">Differential (kPa)</div>
<div class="result-value"><span id="diff_pressure">0</span><span class="result-unit">kPa</span></div></div>
<div class="result-item"><div class="result-label">Differential (psi)</div>
<div class="result-value"><span id="diff_pressure_psi">0</span><span class="result-unit">psi</span></div></div>
</div>
<div id="safety_indicator" class="safety-indicator safety-safe">âœ… Calculating...</div>
<div id="valve_results" style="display:none; background:#e1f5fe; border-left:4px solid #0277bd; padding:15px; border-radius:6px; margin:15px 0;">
<strong style="color:#01579b;">ğŸ”“ Pressure Relief Valve Results:</strong>
<div style="margin-top:10px; font-size:0.95em;">
<div>âš™ï¸ <strong>Activation Altitude:</strong> <span id="valve_activation_alt">--</span>m</div>
<div>ğŸ’¨ <strong>Gas Released:</strong> <span id="valve_gas_released">--</span>g</div>
<div>ğŸ“‰ <strong>Altitude Loss:</strong> <span id="valve_altitude_loss">--</span>m (compared to no valve)</div>
<div>ğŸ¯ <strong>Final Float:</strong> <span id="valve_final_float">--</span>m</div>
</div>
</div>
</div>

<div class="chart-container">
<h3 class="chart-title">ğŸ“Š Pressure vs Altitude</h3>
<div style="height: 400px; position: relative;">
<canvas id="pressureChart"></canvas>
</div>
<div class="info-box"><strong>Chart:</strong> Blue = external pressure (decreases with altitude). Red = internal pressure (equal to external until onset, then increases). Gap = differential pressure (stress on envelope). <span id="valve_chart_note" style="display:none;">Green dashed line shows valve pressure limit.</span></div>
</div>

<div class="chart-container" id="gasMassChartContainer" style="display:none;">
<h3 class="chart-title">ğŸ“Š Gas Mass vs Altitude (Valve Active)</h3>
<div style="height: 400px; position: relative;">
<canvas id="gasMassChart"></canvas>
</div>
<div class="info-box"><strong>Chart:</strong> Shows gas mass during ascent. Blue = with valve (gas vented when limit reached). Gray dashed = without valve (reference). The gap between lines shows total gas released by the valve.</div>
</div>

<div class="chart-container" id="diffPressureChartContainer" style="display:none;">
<h3 class="chart-title">ğŸ“Š Differential Pressure Detail (Valve Active)</h3>
<div style="height: 400px; position: relative;">
<canvas id="diffPressureChart"></canvas>
</div>
<div class="info-box"><strong>Chart:</strong> Shows pressure differential (Î”P = internal - external). Red = would exceed limit without valve. Green = valve maintains pressure at limit. Dashed line shows valve threshold.</div>
</div>

<script src="balloon_calculator.js"></script>
</body>
</html>
